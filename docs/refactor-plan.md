# 项目重构计划

## 当前项目结构分析

### 现状评估

#### 优点
1. **基础架构清晰**: 已有pages、components、hooks、utils的基本分层
2. **组件化程度高**: 已抽象出DataTable、FilterForm等通用组件
3. **Hook使用规范**: useTableData、useFilter等自定义Hook设计合理
4. **工具函数完善**: 日期、导出、表格工具函数功能齐全
5. **技术栈现代**: 使用React 18、Vite、Ant Design等现代技术

#### 存在的问题
1. **页面组件过于庞大**: 单个页面文件行数过多(如DingDanRuKuPiPei.jsx 676行)
2. **业务逻辑耦合**: 页面组件中包含大量业务逻辑和数据处理
3. **组件复用性不足**: 缺少业务级别的可复用组件
4. **数据管理分散**: 每个页面都有独立的数据管理逻辑
5. **样式组织不规范**: 缺少统一的样式变量和规范
6. **类型定义缺失**: 没有TypeScript类型定义
7. **服务层缺失**: 缺少统一的API服务层

## 重构目标

### 主要目标
1. **提高代码可读性**: 减少单个文件的复杂度
2. **增强组件复用性**: 抽象业务组件，减少重复代码
3. **统一数据管理**: 建立标准的数据流和状态管理模式
4. **完善工程化**: 添加类型定义、样式规范等
5. **优化AI操作体验**: 使代码结构更适合AI理解和操作

### 成功标准
1. 单个页面组件代码行数控制在200行以内
2. 业务逻辑通过Hook进行封装
3. 建立完整的组件库和工具库
4. 实现统一的样式系统
5. 所有页面功能正常，无布局错乱

## 重构步骤

### 第一阶段：基础设施完善 (1-2天)

#### 步骤1.1: 建立样式系统
- [ ] 创建CSS变量系统 (`src/styles/variables.css`)
- [ ] 建立全局样式规范 (`src/styles/global.css`)
- [ ] 创建样式混入 (`src/styles/mixins.css`)
- [ ] 更新现有组件样式，使用CSS变量

#### 步骤1.2: 完善工具函数
- [ ] 创建常量定义文件 (`src/utils/constants.js`)
- [ ] 添加表单验证工具 (`src/utils/validationUtils.js`)
- [ ] 创建通用业务工具 (`src/utils/businessUtils.js`)
- [ ] 优化现有工具函数的类型注释

#### 步骤1.3: 建立服务层
- [ ] 创建API服务基础结构 (`src/services/api/`)
- [ ] 建立模拟数据管理 (`src/services/mock/`)
- [ ] 创建数据转换层 (`src/services/transform/`)

### 第二阶段：组件重构 (2-3天)

#### 步骤2.1: 抽象业务组件
- [ ] 创建订单相关组件 (`src/components/business/Order/`)
  - OrderTable: 订单表格组件
  - OrderForm: 订单表单组件
  - OrderDetail: 订单详情组件
- [ ] 创建物料相关组件 (`src/components/business/Material/`)
  - MaterialTable: 物料表格组件
  - MaterialForm: 物料表单组件
  - MaterialSelector: 物料选择器
- [ ] 创建采购相关组件 (`src/components/business/Purchase/`)
  - PurchaseTable: 采购表格组件
  - PurchaseForm: 采购表单组件
  - ContractForm: 合同表单组件

#### 步骤2.2: 优化通用组件
- [ ] 增强DataTable组件功能
  - 添加更多配置选项
  - 支持内联编辑
  - 优化性能
- [ ] 完善FilterForm组件
  - 支持更多筛选类型
  - 添加快捷筛选
  - 优化用户体验
- [ ] 创建新的通用组件
  - StatusTag: 状态标签组件
  - NumberInput: 数字输入组件
  - DateRangePicker: 日期范围选择器

### 第三阶段：Hook重构 (2-3天)

#### 步骤3.1: 业务Hook抽象
- [ ] 创建订单管理Hook (`src/hooks/business/useOrderManagement.js`)
- [ ] 创建物料管理Hook (`src/hooks/business/useMaterialManagement.js`)
- [ ] 创建采购管理Hook (`src/hooks/business/usePurchaseManagement.js`)
- [ ] 创建库存管理Hook (`src/hooks/business/useInventoryManagement.js`)

#### 步骤3.2: 通用Hook优化
- [ ] 增强useTableData功能
  - 支持服务端分页
  - 添加缓存机制
  - 优化性能
- [ ] 完善useFilter功能
  - 支持复杂筛选条件
  - 添加筛选历史
  - 优化用户体验
- [ ] 创建新的通用Hook
  - useExport: 导出功能Hook
  - useModal: 弹窗管理Hook
  - usePermission: 权限管理Hook

### 第四阶段：页面重构 (3-4天)

#### 步骤4.1: 重构核心页面
- [ ] 重构订单入库匹配页面 (`src/pages/OrderWarehousingMatch/`)
  - 拆分为多个子组件
  - 使用业务Hook管理状态
  - 优化用户交互
- [ ] 重构入库管理页面 (`src/pages/Warehousing/`)
  - 简化页面逻辑
  - 使用标准组件
  - 提升性能

#### 步骤4.2: 重构其他页面
- [ ] 按照标准模板重构所有页面
- [ ] 确保页面组件代码行数在合理范围内
- [ ] 统一页面布局和交互模式

### 第五阶段：测试和优化 (1-2天)

#### 步骤5.1: 功能测试
- [ ] 测试所有页面功能正常
- [ ] 检查数据流是否正确
- [ ] 验证用户交互体验

#### 步骤5.2: 性能优化
- [ ] 优化组件渲染性能
- [ ] 减少不必要的重新渲染
- [ ] 优化包大小

#### 步骤5.3: 代码质量检查
- [ ] 检查代码规范一致性
- [ ] 确保组件接口清晰
- [ ] 验证AI操作友好性

## 重构原则

### 1. 渐进式重构
- 每次只重构一个模块
- 保持功能的连续性
- 及时测试和验证

### 2. 向后兼容
- 保持现有API接口不变
- 逐步迁移到新的组件
- 避免破坏性变更

### 3. 质量优先
- 重构过程中不引入新的bug
- 保持代码质量标准
- 及时进行代码审查

### 4. 文档同步
- 及时更新组件文档
- 记录重构过程和决策
- 提供使用示例

## 风险控制

### 1. 技术风险
- **风险**: 重构过程中引入新的bug
- **控制**: 每个步骤后进行充分测试

### 2. 进度风险
- **风险**: 重构时间超出预期
- **控制**: 分阶段进行，可以随时停止

### 3. 兼容性风险
- **风险**: 新旧代码不兼容
- **控制**: 保持API接口稳定，渐进式迁移

## 成果验收

### 1. 代码质量指标
- 单个文件代码行数 < 200行
- 组件复用率 > 60%
- 代码重复率 < 10%

### 2. 功能完整性
- 所有页面功能正常
- 用户体验无降级
- 性能无明显下降

### 3. AI友好性
- 代码结构清晰易懂
- 组件接口标准化
- 文档完善准确

## 后续维护

### 1. 代码规范
- 建立代码审查机制
- 定期进行代码质量检查
- 持续优化组件库

### 2. 文档维护
- 及时更新组件文档
- 记录最佳实践
- 提供培训材料

### 3. 持续改进
- 收集用户反馈
- 优化开发体验
- 跟进技术发展