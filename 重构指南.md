# HRB采购系统重构指南

## 概述

本指南介绍如何使用新创建的公共组件、工具函数和自定义Hooks来重构现有页面，提高代码的可维护性和开发效率。

## 新增的公共资源

### 1. 公共组件 (`src/components/common/`)

#### PageLayout - 页面布局组件
```jsx
import { PageLayout } from '../components/common';

<PageLayout
  title="页面标题"
  description="页面描述"
  headerExtra={<Button>额外操作</Button>}
>
  {/* 页面内容 */}
</PageLayout>
```

#### DataTable - 数据表格组件
```jsx
import { DataTable } from '../components/common';

<DataTable
  title="表格标题"
  description="表格描述"
  columns={columns}
  dataSource={dataSource}
  loading={loading}
  scroll={{ x: 1000, y: 'calc(100vh - 400px)' }}
/>
```

#### FilterForm - 筛选表单组件
```jsx
import { FilterForm } from '../components/common';

<FilterForm
  form={filterForm}
  onFinish={handleFilter}
  onReset={handleReset}
>
  <Col span={6}>
    <Form.Item name="field" label="字段">
      <Input placeholder="请输入" />
    </Form.Item>
  </Col>
</FilterForm>
```

#### ActionBar - 操作按钮栏组件
```jsx
import { ActionBar } from '../components/common';

<ActionBar
  showSave
  showExport
  showAdd
  onSave={handleSave}
  onExport={handleExport}
  onAdd={handleAdd}
/>
```

### 2. 工具函数 (`src/utils/`)

#### 日期工具 (dateUtils.js)
```jsx
import { generateDateColumns, formatDate, getShortDateFormat } from '../utils';

// 生成日期列
const dateColumns = generateDateColumns([startDate, endDate]);

// 格式化日期
const formattedDate = formatDate(date, 'YYYY-MM-DD');
```

#### 表格工具 (tableUtils.js)
```jsx
import { 
  createColumn, 
  createDateColumn, 
  createNumberColumn, 
  createActionColumn 
} from '../utils';

// 创建基础列
const columns = [
  createColumn('name', '名称', { width: 120 }),
  createDateColumn('date', '日期', { width: 120 }),
  createNumberColumn('amount', '数量', { width: 100, precision: 2 }),
  createActionColumn([editButton, deleteButton]),
];
```

#### 导出工具 (exportUtils.js)
```jsx
import { exportTableToExcel } from '../utils';

// 导出表格数据
const handleExport = () => {
  exportTableToExcel(dataSource, columns, '文件名');
};
```

### 3. 自定义Hooks (`src/hooks/`)

#### useTableData - 表格数据管理
```jsx
import { useTableData } from '../hooks';

const {
  loading,
  dataSource,
  filteredDataSource,
  setLoading,
  updateDataSource,
  addItem,
  updateItem,
  deleteItem,
  rowSelection,
} = useTableData({
  initialData: [],
  filterKeys: ['field1', 'field2'],
});
```

#### useFilter - 过滤功能管理
```jsx
import { useFilter } from '../hooks';

const {
  form: filterForm,
  filters,
  handleFilter,
  handleReset,
  updateFilter,
} = useFilter({
  onFilter: (values) => console.log('过滤:', values),
  onReset: () => console.log('重置'),
});
```

## 重构步骤

### 步骤1: 分析现有页面

1. 识别页面的主要功能模块
2. 找出可以复用的组件和逻辑
3. 确定需要重构的部分

### 步骤2: 替换布局结构

**重构前:**
```jsx
const MyPage = () => {
  return (
    <div>
      <div className="page-header">
        <h1>页面标题</h1>
        <p>页面描述</p>
      </div>
      <div className="page-content">
        {/* 内容 */}
      </div>
    </div>
  );
};
```

**重构后:**
```jsx
import { PageLayout } from '../components/common';

const MyPage = () => {
  return (
    <PageLayout title="页面标题" description="页面描述">
      {/* 内容 */}
    </PageLayout>
  );
};
```

### 步骤3: 重构表格组件

**重构前:**
```jsx
<Card className="table-card">
  <div className="table-header">
    <h3>表格标题</h3>
  </div>
  <Table
    columns={columns}
    dataSource={dataSource}
    loading={loading}
    // ... 其他配置
  />
</Card>
```

**重构后:**
```jsx
import { DataTable } from '../components/common';

<DataTable
  title="表格标题"
  columns={columns}
  dataSource={dataSource}
  loading={loading}
/>
```

### 步骤4: 重构筛选功能

**重构前:**
```jsx
<Card className="filter-card">
  <Form form={filterForm} onFinish={handleFilter}>
    <Row gutter={16}>
      <Col span={6}>
        <Form.Item name="field" label="字段">
          <Input />
        </Form.Item>
      </Col>
      <Col span={24}>
        <Button type="primary" onClick={() => filterForm.submit()}>
          查询
        </Button>
        <Button onClick={handleReset}>重置</Button>
      </Col>
    </Row>
  </Form>
</Card>
```

**重构后:**
```jsx
import { FilterForm } from '../components/common';

<FilterForm form={filterForm} onFinish={handleFilter} onReset={handleReset}>
  <Col span={6}>
    <Form.Item name="field" label="字段">
      <Input />
    </Form.Item>
  </Col>
</FilterForm>
```

### 步骤5: 使用自定义Hooks

**重构前:**
```jsx
const [loading, setLoading] = useState(false);
const [dataSource, setDataSource] = useState([]);
const [filteredDataSource, setFilteredDataSource] = useState([]);
const [filterForm] = Form.useForm();

// 大量的状态管理和过滤逻辑...
```

**重构后:**
```jsx
import { useTableData, useFilter } from '../hooks';

const {
  loading,
  dataSource,
  filteredDataSource,
  updateDataSource,
} = useTableData({ initialData: [] });

const {
  form: filterForm,
  handleFilter,
  handleReset,
} = useFilter({
  onFilter: applyFilters,
});
```

### 步骤6: 使用工具函数

**重构前:**
```jsx
// 手动创建列配置
const columns = [
  {
    dataIndex: 'name',
    title: '名称',
    key: 'name',
    width: 120,
  },
  {
    dataIndex: 'date',
    title: '日期',
    key: 'date',
    render: (value) => value ? dayjs(value).format('YYYY-MM-DD') : '-',
  },
  // ...
];
```

**重构后:**
```jsx
import { createColumn, createDateColumn } from '../utils';

const columns = [
  createColumn('name', '名称', { width: 120 }),
  createDateColumn('date', '日期'),
  // ...
];
```

## 重构示例

参考 `src/pages/RuKu_Refactored.jsx` 文件，这是一个完整的重构示例，展示了如何使用所有新的公共资源。

### 重构前后对比

| 方面 | 重构前 | 重构后 |
|------|--------|--------|
| 代码行数 | 408行 | 约250行 |
| 组件复用 | 无 | 高度复用 |
| 状态管理 | 手动管理 | Hook封装 |
| 工具函数 | 重复代码 | 统一工具 |
| 可维护性 | 低 | 高 |

## 重构优势

### 1. 代码复用
- 减少重复代码
- 统一的组件风格
- 更容易维护

### 2. 开发效率
- 快速搭建页面
- 减少样板代码
- 专注业务逻辑

### 3. 一致性
- 统一的交互体验
- 一致的视觉风格
- 标准化的代码结构

### 4. 可维护性
- 集中的组件管理
- 易于修改和扩展
- 更好的代码组织

## 注意事项

### 1. 渐进式重构
- 不要一次性重构所有页面
- 先重构简单的页面
- 逐步积累经验

### 2. 保持兼容性
- 确保重构后功能完整
- 保持原有的用户体验
- 充分测试

### 3. 团队协作
- 统一重构标准
- 代码审查
- 文档更新

## 下一步计划

1. **完成基础重构**: 重构所有页面使用新的公共组件
2. **业务组件抽取**: 创建业务相关的复合组件
3. **状态管理优化**: 考虑引入全局状态管理
4. **类型安全**: 迁移到TypeScript
5. **性能优化**: 优化渲染性能和包大小

## 总结

通过使用新的公共组件、工具函数和自定义Hooks，我们可以显著提高代码的质量和开发效率。重构是一个持续的过程，需要团队的共同努力和持续改进。